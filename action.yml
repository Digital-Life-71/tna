name: '–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è'
description: '–û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram' # –û–ø–∏—Å–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
inputs:
  TELEGRAM_TOKEN:
    description: '–¢–æ–∫–µ–Ω Telegram'
    required: true
    default: ''
  TELEGRAM_CHAT_ID:
    description: 'ID —á–∞—Ç–∞ Telegram'
    required: true
    default: ''
  TELEGRAM_MESSAGE:
    description: '–°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏'
    required: true
    default: |
      üìù Commit: ${{ github.event.head_commit.message }}
      ‚ö†Ô∏è Branch: ${{ github.ref_name }}
      üë§ Author: ${{ github.actor }}
  BUTTON_TEXT:
    description: '–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏'
    required: true
    default: '–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å'
  BUTTON_URL:
    description: 'URL –∫–Ω–æ–ø–∫–∏'
    required: true
    default: 'https://github.com/${{ github.repository }}/commit/${{ github.sha }}'
  DISABLE_NOTIFICATION:
    description: '–û—Ç–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è'
    required: false
    default: 'true'
runs:
  using: 'composite'
  steps:
    - name: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram # –ù–∞–∑–≤–∞–Ω–∏–µ —à–∞–≥–∞
      shell: bash # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–±–æ–ª–æ—á–∫–∏ bash
      env:
        TELEGRAM_TOKEN: ${{ inputs.TELEGRAM_TOKEN }} # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è TELEGRAM_TOKEN
        TELEGRAM_CHAT_ID: ${{ inputs.TELEGRAM_CHAT_ID }} # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è TELEGRAM_CHAT_ID
        TELEGRAM_MESSAGE: ${{ inputs.TELEGRAM_MESSAGE }} # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è TELEGRAM_MESSAGE
        BUTTON_TEXT: ${{ inputs.BUTTON_TEXT }} # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è BUTTON_TEXT
        BUTTON_URL: ${{ inputs.BUTTON_URL }} # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è BUTTON_URL
        DISABLE_NOTIFICATION: ${{ inputs.DISABLE_NOTIFICATION }} # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è DISABLE_NOTIFICATION
      run: |
        set -e
        echo "–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram..."
        PAYLOAD="chat_id=${TELEGRAM_CHAT_ID}&text=${TELEGRAM_MESSAGE}&disable_notification=${DISABLE_NOTIFICATION}&reply_markup={\"inline_keyboard\":[[{\"text\":\"${BUTTON_TEXT}\",\"url\":\"${BUTTON_URL}\"}]]}"
        curl -v -X POST "https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage" -d "${PAYLOAD}"
